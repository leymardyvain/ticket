version: "3.8"

services:
  
  mysql:
    
    image: mysql:8.0
    
    container_name: db_spring_ticket
    
    restart: unless-stopped
  
    environment:
      
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: infoDB
      MYSQL_ROOT_HOST: "%"
      MYSQL_ALLOW_EMPTY_PASSWORD: "yes"

    ports:
      - "3308:3306"

    volumes:
      - dbapp1:/var/lib/mysql
      
    networks:
     springticketnetwork:
      ipv4_address: 172.19.0.2
      
  spring_ticket:
    
    depends_on:
      - mysql
      
    build: ./

    image: yleymard/spring_ticket:latest
        
    restart: on-failure
      
    ports:
      - "8888"
      
    environment:
      SPRING_PROFILES_ACTIVE: prod
        
    volumes:
      - .m2:/root/.m2
    stdin_open: true
    tty: true
    
    networks:
     springticketnetwork:
      ipv4_address: 172.19.0.3
    
  spring_ticket_01:
    
    depends_on:
      - spring_ticket
      
    image: yleymard/spring_ticket:latest
         
    restart: on-failure
    
    ports:
      - "8888"
      
    environment:
      SPRING_PROFILES_ACTIVE: prod
        
    volumes:
      - .m2:/root/.m2
    stdin_open: true
    tty: true
    
    networks:
     springticketnetwork:
      ipv4_address: 172.19.0.4

  spring_ticket_02:
    
    depends_on:
      - spring_ticket_01
      
    image: yleymard/spring_ticket:latest
         
    restart: on-failure
        
    ports:
      - "8888"
      
    environment:
      SPRING_PROFILES_ACTIVE: prod
        
    volumes:
      - .m2:/root/.m2
    stdin_open: true
    tty: true
    
    networks:
     springticketnetwork:
      ipv4_address: 172.19.0.5

  spring_ticket_03:
    
    depends_on:
      - spring_ticket_02
      
    image: yleymard/spring_ticket:latest
         
    restart: on-failure
    
    ports:
      - "8888"
      
    environment:
      SPRING_PROFILES_ACTIVE: prod
        
    volumes:
      - .m2:/root/.m2
    stdin_open: true
    tty: true
    
    networks:
     springticketnetwork:
      ipv4_address: 172.19.0.6

  spring_ticket_04:
    
    depends_on:
      - spring_ticket_03
      
    image: yleymard/spring_ticket:latest
         
    restart: on-failure
    
    ports:
      - "8888"
      
    environment:
      SPRING_PROFILES_ACTIVE: prod
        
    volumes:
      - .m2:/root/.m2
    stdin_open: true
    tty: true
    
    networks:
     springticketnetwork:
      ipv4_address: 172.19.0.7

  hapee-3.1:
   build:
    context: .
    dockerfile: ./haproxy.Dockerfile

   depends_on:
      - spring_ticket_04
      
   ports:
      - "8888:8888"
      - "9092:9092"

   restart: always
      
   networks:
    springticketnetwork:
     ipv4_address: 172.19.0.10
      
volumes:
  dbapp1:
  
networks:
 springticketnetwork:
  driver: bridge
  ipam:
   config:
    - subnet: 172.19.0.0/16
      gateway: 172.19.0.1
