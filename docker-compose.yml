version: "3.8"

services:
  
  mysql:
    
    image: mysql:8.0
    
    container_name: db_spring_ticket
    
    restart: unless-stopped
        
    environment:
      
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: infoDB
      MYSQL_ROOT_HOST: "%"
      MYSQL_ALLOW_EMPTY_PASSWORD: "yes"

    ports:
      - "3308:3306"

    volumes:
      - dbapp1:/var/lib/mysql
      
    networks:
     - springticketnetwork
      
  webserver01:

    depends_on:
      - mysql
      
    build: ./

    image: yleymard/spring_ticket:latest

    container_name: webserver01
    
    restart: on-failure
    
    ports:
      - "8788"
      
    environment:
      SPRING_PROFILES_ACTIVE: prod
        
    volumes:
      - .m2:/root/.m2
    stdin_open: true
    tty: true
    
    networks:
     - springticketnetwork
    
  webserver02:
    
    depends_on:
      - webserver01
      
    image: yleymard/spring_ticket:latest

    container_name: webserver02
         
    restart: on-failure
    
    ports:
      - "8788"
      
    environment:
      SPRING_PROFILES_ACTIVE: prod
        
    volumes:
      - .m2:/root/.m2
    stdin_open: true
    tty: true
    
    networks:
     - springticketnetwork

  webserver03:
    
    depends_on:
      - webserver02
      
    image: yleymard/spring_ticket:latest

    container_name: webserver03
         
    restart: on-failure
        
    ports:
      - "8788"
      
    environment:
      SPRING_PROFILES_ACTIVE: prod
        
    volumes:
      - .m2:/root/.m2
    stdin_open: true
    tty: true
    
    networks:
     - springticketnetwork

  webserver04:
    
    depends_on:
      - webserver03
      
    image: yleymard/spring_ticket

    container_name: webserver04
         
    restart: on-failure
    
    ports:
      - "8788"
      
    environment:
      SPRING_PROFILES_ACTIVE: prod
        
    volumes:
      - .m2:/root/.m2
    stdin_open: true
    tty: true
    
    networks:
     - springticketnetwork

  webserver05:
    
    depends_on:
      - webserver04
      
    image: yleymard/spring_ticket:latest

    container_name: webserver05
         
    restart: on-failure
    
    ports:
      - "8788"
      
    environment:
      SPRING_PROFILES_ACTIVE: prod
        
    volumes:
      - .m2:/root/.m2
    stdin_open: true
    tty: true
    
    networks:
     - springticketnetwork

  hapee-3.1:
   build:
    context: .
    dockerfile: ./haproxy.Dockerfile

   depends_on:
      - webserver05
      
   ports:
      - "8788:8788"
      - "9092:9092"

   restart: always
      
   networks:
    - springticketnetwork
      
volumes:
  dbapp1:
  
networks:
 springticketnetwork:
  driver: bridge
